import { describe, expect, test } from 'vitest';

import { type ChainId } from 'chains';

import { decodeShortID, encodeShortID } from './shortId';

type TestData = {
  chainId: ChainId;
  loanId: string | number | bigint;
}[];

const testData: TestData = [
  // bigint
  {
    chainId: 8453,
    loanId:
      60986943691264479222933283826978528416519351522353997001726053302035134565021n,
  },
  // numbers
  {
    chainId: 8453,
    loanId: Number.MAX_SAFE_INTEGER,
  },
  {
    chainId: 8453,
    loanId: 1234567890,
  },
  // actual data from prod db
  {
    chainId: 8453,
    loanId:
      '60986943691264479222933283826978528416519351522353997001726053302035134565021',
  },
  {
    chainId: 8453,
    loanId:
      '22710296591395440746669163292865209985683050680064724689696988865947637114383',
  },
  {
    chainId: 1,
    loanId:
      '71508877980715884445674179889217525577483966608442104593051609416770366337177',
  },
  {
    chainId: 8453,
    loanId:
      '19851453590368697553160789663848410804677846369241275625426514145135902094126',
  },
  {
    chainId: 8453,
    loanId:
      '18190319291066261234069627047333437614936490922870517093030930717918525690966',
  },
  {
    chainId: 8453,
    loanId:
      '24129708412172960482953402719400387035281001431187316885660266550280383074980',
  },
  {
    chainId: 8453,
    loanId:
      '40568524285281039263861976283177647709984366851482645868264932410506960293851',
  },
  {
    chainId: 8453,
    loanId:
      '69218468206715964276964191429268550796193318263000718694177894794788908165758',
  },
  {
    chainId: 8453,
    loanId:
      '16117753701329825494544614194500359099350495093889491223840176111683066274618',
  },
  {
    chainId: 8453,
    loanId:
      '96659782116187850481077000748722175934339723050933408443932453744556227590916',
  },
  {
    chainId: 8453,
    loanId:
      '10640208336069582624055459531173303684453848771331115497588651105057597713658',
  },
  {
    chainId: 8453,
    loanId:
      '101645554560764778375558342437233793447554092708103081810839659724780019807850',
  },
  {
    chainId: 11155111,
    loanId:
      '86645110329598229238948412041146582692354566086637722791162689072067240428937',
  },
  {
    chainId: 8453,
    loanId:
      '35263597867220490084662019130141380977353144367311642577218059672966201437534',
  },
  {
    chainId: 8453,
    loanId:
      '74421740302080912136878483452803491237371258644412919224190213936508126644035',
  },
  {
    chainId: 8453,
    loanId:
      '74919755916212745613208821613304114650554306064427352735604705219383340099005',
  },
  {
    chainId: 11155111,
    loanId:
      '62170444286110374940352540855571885157967513718084200935899772819541931667107',
  },
  {
    chainId: 11155111,
    loanId:
      '18327477209815479738679249424316571017014485548526899038127480713107721004348',
  },
  {
    chainId: 11155111,
    loanId:
      '75188833935591841927327510781009793466214488757119248713459932732810382449007',
  },
  {
    chainId: 11155111,
    loanId:
      '32182828665727870410746032163059584530034849875093887475996333447517458381212',
  },
  {
    chainId: 11155111,
    loanId:
      '91779789851857234493700935014768009936221930918575143790613465844279471421205',
  },
  {
    chainId: 11155111,
    loanId:
      '1170405822814526619944924270979990520361969655662869828311481561711649742347',
  },
  {
    chainId: 8453,
    loanId:
      '56529225775677229087442284238687069272222604462729059239215878289487033160644',
  },
  {
    chainId: 8453,
    loanId:
      '95715810263332893609109238001231943895313022787168385811900267454386771358091',
  },
  {
    chainId: 11155111,
    loanId:
      '35784387784878060968001954106650118176696036958009553771549236777492742805610',
  },
  {
    chainId: 8453,
    loanId:
      '25052850212552499009255866897292638681232292956266078168331474212904710621536',
  },
  {
    chainId: 8453,
    loanId:
      '96677937324819045611063341671805853035222224871433405562495687690720877563290',
  },
  {
    chainId: 11155111,
    loanId:
      '438571903449039006808934072908526055601818557141423645867301050778686411769',
  },
  {
    chainId: 8453,
    loanId:
      '72819280184083865665670901402611594751152032637249983539298536103324950657546',
  },
];

describe('shortId', () => {
  for (const { chainId, loanId } of testData) {
    test(`encodes and decodes loadIds. loanId: ${loanId}, chainId: ${chainId}`, () => {
      const encoded = encodeShortID({ chainId, value: loanId });
      const decoded = decodeShortID(encoded);

      expect(decoded.value).toEqual(loanId.toString());
      expect(decoded.chainId).toEqual(chainId);
    });
  }
});
